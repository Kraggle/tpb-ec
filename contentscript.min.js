console.log=function(){};var _e={ep:{},day:{}},changed=!1,url="https://www.ettvdl.com",options,msgTimer,epList,dayList,downloading,index,testTime,oldHref="old",openTPB=new RegExp("1MtrxZFWz3FG9MobYWzxR2tRq4ybWJahmb","i"),magnetList=[],dlList=[],gettingMagnet=!1,dIndex=0,dialogue=()=>{const d=$("<div />",{class:"app-dialogue",i:dIndex}).appendTo($("body"));var dBorder=$("<div />",{class:"app-dialogue-border"}).appendTo(d);$("<span />",{class:"app-dialogue-click",text:"Click anywhere to continue the queue!"}).appendTo(dBorder),$("<span />",{class:"app-dialogue-sorry",text:"This is necessary since chrome updated the way external applications are selected. Without this you can not download in bulk as the rest of the queue would be ignored."}).appendTo(dBorder),$("<span />",{class:"app-dialogue-click",text:"or..."}).appendTo(dBorder),$("<span />",{class:"app-dialogue-sorry",text:"If you have the latest version of chrome, you can check the 'Always allow episodecalendar.com...' in the popup dialogue, then check this next box to download in bulk again. Thank you chrome developers."}).appendTo(dBorder);var dLabel=$("<label />",{class:"app-dialogue-check",for:"clicked-it"}).appendTo(dBorder),dInput=$("<input />",{class:"app-dialogue-checkbox",type:"checkbox",id:"clicked-it"}).prop("checked",options.clicked).appendTo(dLabel);return $("<span />",{class:"app-dialogue-text",text:"I've selected 'Always allow episodecalendar.com to open links...'"}).appendTo(dLabel),$("<div />",{class:"app-dialogue-back mark"}).appendTo(dLabel),$("<div />",{class:"app-dialogue-tick mark"}).appendTo(dLabel),dLabel.on("click",(function(e){e.stopPropagation(),options.clicked=dInput.is(":checked"),chrome.storage.sync.set({quality:options.quality,hevc:options.hevc,check:options.check,clicked:options.clicked})})),dIndex++,d};function message(text){var mb=$(".app-message-box");mb.text(text).addClass("active"),msgTimer&&clearTimeout(msgTimer),msgTimer=setTimeout((function(){mb.removeClass("active")}),1e4)}function addListener(){$('a[href!=""]').off("click").on("click",(function(e){"https://episodecalendar.com"+$(this).attr("href")!=oldHref&&changeInterval(),addListener()}));var cls=".epic-episode-marker-wrapper";$("body").off("click",cls).on("click",cls,(function(){var box=$(this).closest(".calendar-day");$("input:not(:checked)",box).length?$(".calendar_date",box).removeClass("seen"):$(".calendar_date",box).addClass("seen"),refreshNotification()}))}function changeInterval(){var oldBody=$("body")[0],int=setInterval((function(){window.location.href!=oldHref&&$("body")[0]==oldBody&&(check(),clearInterval(int)),oldBody=$("body")[0]}),1e3)}function check(){oldHref=window.location.href;var now=new Date;if(now.setHours(23,59,59),dayList=[],cls=".epic-episode-marker-wrapper input:not(:checked)",$("body").hasClass("calendar")){var id=$("td.month h2").first().text()+"_"+$("p.year").first().text();_e.ep[id]||(_e.ep[id]=[]),epList=_e.ep[id],_e.day[id]||(_e.day[id]=[]),dayList=_e.day[id],$("#page_container .magnetized").length||(epList.length=0,$(".episode-item").each((function(i,el){ep=new episode,ep.id=$(this).attr("id"),ep.title=$(this).find(".show").text(),ep.episode=$(this).find(".episode").text().match(/\((S\d+E\d+)\)/)[1],ep.checked=$(this).hasClass("seen"),ep.released=$(this).find("input").length>0,epList.push(ep)})),$(".calendar_cell_content").each((function(i,el){var d=new day;d.id=$(this).attr("id"),d.released=$("input",this).length>0,0==$("input:not(:checked)",this).length&&d.head().addClass("seen"),dayList.push(d)})))}else if($("body").hasClass("unwatched")){var id=$(".cached-view:visible").attr("id");_e.ep[id]||(_e.ep[id]=[]),epList=_e.ep[id],$(".cached-view:visible .magnetized").length||(epList.length=0,$(".cached-view:visible .season").each((function(i,el){var season,title=$(this).find("h2").find("a").text().match(/(.*) - Season \d/)[1].replace(/[,.-]/,"");$("<div />",{class:"separator"}).appendTo($(".epic-list-episode",this));var box=$("<div />",{class:"magnet-container center"}).appendTo($(".epic-list-episode",this));$("<div />",{class:"grey margin_bottom_mini"}).text("Magnet").appendTo(box),$(".epic-list-episode",this).each((function(j,eli){var ep=new episode;ep.id=$(this).attr("id"),ep.title=title,ep.episode=$(this).find(".mid_grey").find("strong").text(),ep.checked=!1;var date=$(this).find(".date").find("strong").text();ep.released=new Date(date).getTime()<now.getTime(),epList.push(ep)}))})))}else if($("body").hasClass("show")){if(0==$(".description").length){const lang={en:"eng",br:"por",de:"deu",dk:"dan",es:"spa",fr:"fra",gr:"eng",it:"ita",nl:"nld",pl:"pol",pt:"por",ro:"eng",rs:"eng",ru:"rus",se:"swe",tu:"tur"},lRef=lang[$("#logo").attr("href").replace("/","")],tvLink=$(".links a:nth-of-type(2)").attr("href").replace(/https{0,1}/,"https");chrome.runtime.sendMessage({url:tvLink},(function(data){$(".page-container.pad_top .col-24").before($("<p />",{class:"description",text:$(`#translations div[data-language=${lRef}] p:nth-of-type(1)`,data.success).text()}))}))}const id=$(".cached-view:visible").attr("id");if(_e.ep[id]||(_e.ep[id]=[]),epList=_e.ep[id],!$(".cached-view:visible .magnetized").length){epList.length=0,$("<div />",{class:"separator"}).appendTo($(".cached-view:visible .epic-list-episode"));var box=$("<div />",{class:"magnet-container center"}).appendTo($(".cached-view:visible .epic-list-episode"));$("<div />",{class:"grey margin_bottom_mini"}).text("Magnet").appendTo(box),title=$(".show_banner").find("h1").text().replace(/[,.-]/,""),$(".cached-view:visible .epic-list-episode").each((function(i,el){var ep=new episode;ep.id=$(this).attr("id"),ep.title=title,ep.episode=$(this).find(".mid_grey").find("strong").text();var check=$(this).find(".epic-episode-marker");ep.checked=check.length&&check.checked;var date=$(this).find(".date").find("strong").text();ep.released=new Date(date).getTime()<now.getTime(),epList.push(ep)}))}}if($.each(epList,(function(i,item){if(!item.get().hasClass("magnetized")&&item.released){var box=item.get().find(".magnet-container");(magnet=$("<div />",{class:box.length?"big magnet":"magnet",title:"Download!"}).attr("index",i).appendTo(box.length?box:item.get())).on("click",addToQueue),$("<div />",{class:"loader"}).hide().appendTo(magnet),item.get().addClass("magnetized")}else item.released||item.get().find(".magnet-container .grey").css("opacity",0)})),$.each(dayList,(function(i,item){var magnet;!item.get().hasClass("magnetized")&&item.released&&($("<div />",{class:"magnet",title:"Download all unwatched from day!"}).attr("index",i).appendTo(item.head()).on("click",getDayMagnets),item.get().addClass("magnetized"))})),!$("#menu").hasClass("magnetized")){var magnet=$("<li />",{class:"download-all"}).appendTo($("#menu")),a;$("<a />",{id:"download-btn",href:""}).text("Download all").appendTo(magnet).on("click",getAllMagnets),$("<span />",{class:"menu-notification",id:"dl-count"}).text("0").appendTo(magnet),$("#menu").addClass("magnetized")}refreshNotification(),addListener()}function getAllMagnets(e){e.preventDefault(),$.each(epList,(function(i,item){$("input:not(:checked)",item.get()).length&&addToQueue.call($(".magnet",item.get()).get(0))}))}function getDayMagnets(e){var item=dayList[$(this).attr("index")];$(".magnet",item.get()).each((function(i,el){var item=epList[$(this).attr("index")];$("input",item.get()).is(":checked")||addToQueue.call($(".magnet",item.get()).get(0))}))}function refreshNotification(){setTimeout((function(){$("body").hasClass("calendar")?$("#dl-count").text($(cls).length):$("#dl-count").text($(".cached-view:visible "+cls).length)}),1e3)}function addToQueue(){$(this).off("click"),epList[$(this).attr("index")].get().find(".loader").fadeIn("250"),magnetList.push($(this).attr("index")),getMagnet.call(epList[magnetList[0]].get().find(".magnet"))}function toDLQueue(item){dlList.push(item),download()}function getMagnet(e){if(!gettingMagnet){gettingMagnet=!0;var $this=$(this),item=epList[$(this).attr("index")],loader=item.get().find(".loader");chrome.storage.sync.get({quality:1,hevc:!0,check:!0,index:0,clicked:!1},(function(items){var html;index=(options=items).index,chrome.runtime.sendMessage({url:item.getETTV()},(function(data){data.error?(console.error("Something went wrong getting the magnet"),hideLoader($this,loader),getNextMagnet()):(html=data.success,"string"===$.type(html)&&html.bMatch(/<title>Advanced Search | ETTV Torrents | Official<\/title>/i)?resumeWork():(console.error("Something went wrong with the verification of the data"),hideLoader($this,loader),getNextMagnet()))}));var resumeWork=function(){if(item.download())toDLQueue(item),options.check&&$("input:not(:checked)",item.get()).click(),hideLoader($this,loader),getNextMagnet();else{var dls={};$(".table-bordered tr:has(td)",html).each((function(){var dl={};$(this).children().each((function(i){1==i?dl.href=url+$("a[href]",this).attr("href"):3==i?dl.size=toMB($(this).text()):5==i&&(dl.seed=+$("b",this).text().replace(",",""))})),dl.quality=dl.href.bMatch(/1080p/i)?"1080":dl.href.bMatch(/720p/i)?"720":"Standard",dl.hevc=dl.href.bMatch(/HEVC|x265/i);var match=`m${dl.quality}${dl.hevc?"HEVC":""}`;(!dls[match]||dls[match].seed<dl.seed)&&(dls[match]=dl,item[match]=dl.href)})),console.log(item,item.getType()),chrome.runtime.sendMessage({getLink:!0,item:item,type:item.getType()},(function(a){if(console.log(a),a.error)return hideLoader($this,loader),void getNextMagnet();item[item.getType()]=a.item[item.getType()],item.download()&&toDLQueue(item),hideLoader($this,loader),getNextMagnet()}))}}}))}}function getNextMagnet(){magnetList.shift(),gettingMagnet=!1,magnetList.length>0&&getMagnet.call(epList[magnetList[0]].get().find(".magnet"))}function download(){downloading||(downloading=!0,window.location=dlList[0].download(),options.clicked?setTimeout(()=>{downloadNext()},1e3):dialogue().fadeIn(800).on("click",(function(e){$(this).fadeOut(400),setTimeout(()=>{$(this).remove(),downloadNext()},400)})),options.check&&$("input:not(:checked)",dlList[0].get()).click(),refreshNotification())}function downloadNext(){dlList.shift(),downloading=!1,dlList.length>0&&download()}function cleanURL(url){return(url||"").replace(/https{0,1}:\/\//,"")}function stripShit(data){return data.replace(/<(style|head|script).{0,}?>[\s\S]+?<\/(style|head|script)>/gi,"").replace(/<(link|img|meta).+?>/gi,"")}function isValid(url){return/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url)}function hideLoader(el,loader){el.on("click",addToQueue),loader.fadeOut("250")}function episode(data){for(key in this.id,this.title,this.episode,this.checked,this.released,this.m1080,this.m1080HEVC,this.m720,this.m720HEVC,this.mStandard,this.get=function(){return $("#"+this.id)},this.getTitle=function(){return $.trim(this.title.replace(/the inhumans/i,"Inhumans").replace(/('|\(\d+\)|\& )/g,""))},this.getETTV=function(){var s=this.getTitle().replace(/ |\./g,"+")+"+"+this.episode;return url+"/torrents-search.php?search="+s},this.getRegex=function(){return new RegExp(this.getTitle().replace(/ /g,".+").replace(/S.H.I.E.L.D./,"(S.H.I.E.L.D|SHIELD)")+".+"+this.episode,"i")},this.download=function(){var q=options.quality;if(options.hevc){if((2==q||1==q&&!this.m720HEVC)&&this.m1080HEVC)return this.m1080HEVC;if((1==q||2==q)&&this.m720HEVC)return this.m720HEVC}if((2==q||1==q&&!this.m720)&&this.m1080)return this.m1080;if((1==q||2==q)&&this.m720)return this.m720;if(this.mStandard)return this.mStandard;if(0==q){if(options.hevc){if(this.m720HEVC)return this.m720HEVC;if(this.m1080HEVC)return this.m1080HEVC}if(this.m720)return this.m720;if(this.m1080)return this.m1080}},this.getType=function(){var q=options.quality;if(options.hevc){if((2==q||1==q&&!this.m720HEVC)&&this.m1080HEVC)return"m1080HEVC";if((1==q||2==q)&&this.m720HEVC)return"m720HEVC"}if((2==q||1==q&&!this.m720)&&this.m1080)return"m1080";if((1==q||2==q)&&this.m720)return"m720";if(this.mStandard)return"mStandard";if(0==q){if(options.hevc){if(this.m720HEVC)return"m720HEVC";if(this.m1080HEVC)return"m1080HEVC"}if(this.m720)return"m720";if(this.m1080)return"m1080"}},data)this[key]=data[key]}function day(){this.id,this.released,this.get=function(){return $("#"+this.id)},this.head=function(){return this.get().parent().find(".calendar_date")}}function toMB(str){if(str.includes(" MB"))return Math.round(+str.replace(" MB",""));var n=+str.replace(" GB","");return Math.round(1024*n)}$((function(){chrome.runtime.sendMessage({proxies:!0},(function(data){url=data})),addListener(),$("<div />",{class:"app-message-box"}).appendTo($("body")),changeInterval()})),function($){function isDOMAttrModifiedSupported(){var p=document.createElement("p"),flag=!1;if(p.addEventListener)p.addEventListener("DOMAttrModified",(function(){flag=!0}),!1);else{if(!p.attachEvent)return!1;p.attachEvent("onDOMAttrModified",(function(){flag=!0}))}return p.setAttribute("id","target"),flag}function checkAttributes(chkAttr,e){if(chkAttr){var attributes=this.data("attr-old-value");if(e.attributeName.indexOf("style")>=0){attributes.style||(attributes.style={});var keys=e.attributeName.split(".");e.attributeName=keys[0],e.oldValue=attributes.style[keys[1]],e.newValue=keys[1]+":"+this.prop("style")[$.camelCase(keys[1])],attributes.style[keys[1]]=e.newValue}else e.oldValue=attributes[e.attributeName],e.newValue=this.attr(e.attributeName),attributes[e.attributeName]=e.newValue;this.data("attr-old-value",attributes)}}var MutationObserver=window.MutationObserver||window.WebKitMutationObserver;$.fn.attrchange=function(a,b){if("object"==typeof a){var cfg={trackValues:!1,callback:$.noop};if("function"==typeof a?cfg.callback=a:$.extend(cfg,a),cfg.trackValues&&this.each((function(i,el){for(var attributes={},attr,i=0,attrs=el.attributes,l=attrs.length;i<l;i++)attributes[(attr=attrs.item(i)).nodeName]=attr.value;$(this).data("attr-old-value",attributes)})),MutationObserver){var mOptions={subtree:!1,attributes:!0,attributeOldValue:cfg.trackValues},observer=new MutationObserver((function(mutations){mutations.forEach((function(e){var _this=e.target;cfg.trackValues&&(e.newValue=$(_this).attr(e.attributeName)),void 0===$(this).data("attrchange-tdisconnect")&&cfg.callback.call(_this,e)}))}));return this.data("attrchange-method","Mutation Observer").data("attrchange-obs",observer).each((function(){observer.observe(this,mOptions)}))}return isDOMAttrModifiedSupported()?this.data("attrchange-method","DOMAttrModified").on("DOMAttrModified",(function(event){event.originalEvent&&(event=event.originalEvent),event.attributeName=event.attrName,event.oldValue=event.prevValue,void 0===$(this).data("attrchange-tdisconnect")&&cfg.callback.call(this,event)})):"onpropertychange"in document.body?this.data("attrchange-method","propertychange").on("propertychange",(function(e){e.attributeName=window.event.propertyName,checkAttributes.call($(this),cfg.trackValues,e),void 0===$(this).data("attrchange-tdisconnect")&&cfg.callback.call(this,e)})):this}if("string"==typeof a&&$.fn.attrchange.hasOwnProperty("extensions")&&$.fn.attrchange.extensions.hasOwnProperty(a))return $.fn.attrchange.extensions[a].call(this,b)}}(jQuery),String.prototype.bMatch||(String.prototype.bMatch=function(regExp){var s;return null!==this.toString().match(regExp)});
//# sourceMappingURL=contentscript.min.js.map